(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51502d00"],{"28a3":function(t,e,a){"use strict";var n=a("2902"),i=a.n(n);i.a},2902:function(t,e,a){},"6f07":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[t._v("首页")]),a("el-breadcrumb-item",[t._v("发布任务")]),a("el-breadcrumb-item",[t._v("任务列表")])],1),a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.wholeloading,expression:"wholeloading"}]},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{clear:function(e){return t.handleCurrentChange(1)}},model:{value:t.queryInfo.query,callback:function(e){t.$set(t.queryInfo,"query",e)},expression:"queryInfo.query"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(e){return t.handleCurrentChange(1)}},slot:"append"})],1)],1),a("el-col",{attrs:{span:4}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"#","http-request":t.uploadData,"show-file-list":!1,"before-upload":t.checkUploadZip}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"将所有dcm放至一个zip压缩包上传",placement:"top-start"}},[a("el-button",{attrs:{size:"medium",type:"primary"}},[t._v("点击上传")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.datalist,stripe:"",border:""}},[a("el-table-column",{attrs:{type:"index"}}),a("el-table-column",{attrs:{prop:"data_id",label:"数据编号",width:"80"}}),a("el-table-column",{attrs:{prop:"data_name",label:"数据名称","min-width":"150"}}),a("el-table-column",{attrs:{prop:"age",label:"年龄",width:"70"}}),a("el-table-column",{attrs:{label:"上传时间",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.upload_time))]}}])}),a("el-table-column",{attrs:{label:"数据裁剪",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.gotoBox(e.row.data_id)}}},[t._v("裁剪")])]}}])}),a("el-table-column",{attrs:{label:"AI建模",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.startAi(e.row)}}},[t._v("运行")])]}}])}),a("el-table-column",{attrs:{label:"AI模型下载",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"===e.row.ai_status?a("span",[t._v("未运行")]):t._e(),"1"===e.row.ai_status?a("span",[t._v("正在计算")]):t._e(),"2"===e.row.ai_status?a("span",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){t.setRightDialogVisible=!0,t.downDiag.dataid=e.row.data_id,t.downDiag.type="0"}}},[a("i",{staticClass:"el-icon-download",staticStyle:{"font-size":"12px"}})])],1):t._e()]}}])}),a("el-table-column",{attrs:{label:"AI完成时间",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[null===e.row.ai_finish_time?a("span",[t._v("未完成")]):t._e(),null!==e.row.ai_finish_time?a("span",[t._v(t._s(e.row.ai_finish_time))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"AI预览",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[null!==e.row.ai_finish_time?a("span",[a("a",{attrs:{href:"/cardiacSTLViewer/model.html?dataid="+e.row.data_id+"&type=0",target:"_blank"}},[t._v("预览")])]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"process_user",label:"处理人"},scopedSlots:t._u([{key:"default",fn:function(e){return[null===e.row.process_user?a("span",[t._v("无")]):t._e(),null!==e.row.process_user?a("span",[t._v(t._s(e.row.process_user))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"模型下载",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[null===e.row.finish_time?a("span",[t._v("无")]):t._e(),null!==e.row.finish_time?a("span",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){t.setRightDialogVisible=!0,t.downDiag.dataid=e.row.data_id,t.downDiag.type="1"}}},[a("i",{staticClass:"el-icon-download",staticStyle:{"font-size":"12px"}})])],1):t._e()]}}])}),a("el-table-column",{attrs:{label:"完成时间",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[null===e.row.finish_time?a("span",[t._v("无")]):t._e(),null!==e.row.finish_time?a("span",[t._v(t._s(e.row.finish_time))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"预览",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[null!==e.row.finish_time?a("span",[a("a",{attrs:{href:"/cardiacSTLViewer/model.html?dataid="+e.row.data_id+"&type=1",target:"_blank"}},[t._v("预览")])]):t._e()]}}])})],1),a("el-pagination",{attrs:{"current-page":t.queryInfo.pagenum,"page-sizes":[10,15,20],"page-size":t.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:t.total,background:""},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:"选择STL模型",visible:t.setRightDialogVisible,width:"30%"},on:{"update:visible":function(e){t.setRightDialogVisible=e},close:t.setRightDialogClosed}},[a("el-checkbox",{attrs:{indeterminate:t.downDiag.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.downDiag.checkAll,callback:function(e){t.$set(t.downDiag,"checkAll",e)},expression:"downDiag.checkAll"}},[t._v("全选")]),a("div",{staticStyle:{margin:"15px 0"}}),a("el-checkbox-group",{on:{change:t.handleCheckedOptionsChange},model:{value:t.downDiag.checkedOptions,callback:function(e){t.$set(t.downDiag,"checkedOptions",e)},expression:"downDiag.checkedOptions"}},t._l(t.downDiag.options,(function(e){return a("el-checkbox",{key:e,staticClass:"cardiacCheckbox",attrs:{label:e}},[t._v(t._s(e))])})),1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.setRightDialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.downloadSTLs}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"上传",visible:t.uploadDialogVisible,width:"25%"},on:{"update:visible":function(e){t.uploadDialogVisible=e},close:t.interuptUpload}},[a("div",{staticStyle:{"text-align":"center"}},[a("el-progress",{staticStyle:{"margin-left":"20px"},attrs:{type:"circle",percentage:t.uploadDiag.progressPercent}}),a("h5",[t._v(t._s(t.uploadDiag.text))])],1)])],1)},i=[],o=(a("c975"),a("b0c0"),a("a9e3"),a("b680"),a("8a79"),a("96cf"),a("1da1")),s=["肺动脉","左心房肺静脉","上腔静脉","主动脉","右心房","右心室","左心室","心包"],r={data:function(){return{wholeloading:!1,loading:!1,uploadDialogVisible:!1,queryInfo:{query:"",pagenum:1,pagesize:10},datalist:[],total:0,setRightDialogVisible:!1,downDiag:{type:null,dataid:null,checkAll:!1,checkedOptions:[],options:s,isIndeterminate:!1},uploadDiag:{progressPercent:0,text:"正在上传"},source:null,timer:null}},methods:{getDataList:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return clearInterval(t.timer),t.loading=!0,e.next=4,t.$http.post("data/publishlist",{queryinfo:t.queryInfo});case 4:a=e.sent,n=a.data,100===n.status&&(t.datalist=n.data.list,t.total=n.data.total,t.loading=!1,t.containsAIundone()&&(t.timer=setInterval(t.getDataList2,2e4)));case 7:case"end":return e.stop()}}),e)})))()},getDataList2:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.post("data/publishlist",{queryinfo:t.queryInfo});case 2:a=e.sent,n=a.data,100===n.status&&(t.datalist=n.data.list,t.total=n.data.total,t.containsAIundone()||clearInterval(t.timer));case 5:case"end":return e.stop()}}),e)})))()},containsAIundone:function(){for(var t=0;t<this.datalist.length;t++)if("1"===this.datalist[t].ai_status)return!0;return!1},checkUploadZip:function(t){return!1===t.name.endsWith(".zip")?(this.$message({message:"请上传zip格式压缩包",type:"error"}),!1):t.size>209715200?(this.$message({message:"文件大小不超过200m",type:"error"}),!1):void 0},uploadData:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var n,i,o,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=new FormData,n.append("zipfile",t.file),e.$message({message:"文件正在上传，请等待！",type:"warning"}),e.source=e.$http.CancelToken.source(),i={"Content-Type":"multipart/form-data",cancelToken:e.source.token,onUploadProgress:function(t){e.uploadDiag.progressPercent=Number((t.loaded/t.total*100).toFixed(2)),100===e.uploadDiag.progressPercent&&(e.uploadDiag.text="正在解析")}},e.uploadDialogVisible=!0,e.uploadDiag.progressPercent=0,e.uploadDiag.text="正在上传",a.next=10,e.$http.post("data/uploaddicom",n,i);case 10:o=a.sent,s=o.data,e.uploadDialogVisible=!1,100===s.status&&(e.$message({message:"上传成功",type:"success"}),e.getDataList());case 14:case"end":return a.stop()}}),a)})))()},handleSizeChange:function(t){this.queryInfo.pagesize=t,this.queryInfo.pagenum=1,this.getDataList()},handleCurrentChange:function(t){this.queryInfo.pagenum=t,this.getDataList()},setRightDialogClosed:function(){this.downDiag.checkedOptions=[],this.downDiag.checkAll=!1,this.downDiag.isIndeterminate=!1,this.downDiag.dataid=null},downloadSTLs:function(){var t=this.downDiag.checkedOptions;if(0!==t.length){for(var e=this.downDiag.options,a="",n=0;n<e.length;n++)-1!==t.indexOf(e[n])?a+="1":a+="0";this.$message({message:"正在生成压缩包",type:"success"});var i=this.$http.defaults.baseURL;"0"===this.downDiag.type?window.location=i+"/data/aistl/"+this.downDiag.dataid+"/"+a:"1"===this.downDiag.type&&(window.location=i+"/data/downloadSTL/"+this.downDiag.dataid+"/"+a),this.setRightDialogVisible=!1}else this.$message({message:"未勾选",type:"error"})},handleCheckAllChange:function(t){this.downDiag.checkedOptions=t?this.downDiag.options:[],this.downDiag.isIndeterminate=!1},handleCheckedOptionsChange:function(t){var e=t.length;this.downDiag.checkAll=e===this.downDiag.options.length,this.downDiag.isIndeterminate=e>0&&e<this.downDiag.options.length},gotoBox:function(t){this.$router.push("/box?id="+t)},interuptUpload:function(){this.uploadDiag.progressPercent<100&&this.source.cancel()},startAi:function(t){var e=this;"1"!==t.ai_status?null!==t.box&&""!==t.box?this.$confirm("确定使用AI进行建模","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(Object(o["a"])(regeneratorRuntime.mark((function a(){var n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.loading=!0,a.next=3,e.$http.get("data/ai/"+t.data_id);case 3:n=a.sent,i=n.data,e.loading=!1,100===i.status&&(e.$message({type:"success",message:"已提交"}),e.getDataList());case 7:case"end":return a.stop()}}),a)})))).catch((function(){e.$message({type:"info",message:"已取消"})})):this.$message({message:"请先裁剪",type:"error"}):this.$message({message:"正在计算，请稍后",type:"warning"})}},created:function(){this.getDataList()},beforeDestroy:function(){console.log("before destory"),clearInterval(this.timer)}},l=r,c=(a("28a3"),a("2877")),u=Object(c["a"])(l,n,i,!1,null,"770b02c3",null);e["default"]=u.exports},a640:function(t,e,a){"use strict";var n=a("d039");t.exports=function(t,e){var a=[][t];return!!a&&n((function(){a.call(null,e||function(){throw 1},1)}))}},c975:function(t,e,a){"use strict";var n=a("23e7"),i=a("4d64").indexOf,o=a("a640"),s=a("ae40"),r=[].indexOf,l=!!r&&1/[1].indexOf(1,-0)<0,c=o("indexOf"),u=s("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:l||!c||!u},{indexOf:function(t){return l?r.apply(this,arguments)||0:i(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-51502d00.1656048607808.js.map